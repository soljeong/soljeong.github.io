---
layout: post
title: 윈도우에서 네트워크 보안
aliases: 
published: true
---
## mysql DB가 또 털렸다
- 공유기에 DNS를 설정해놔서, mealddang.iptime.org 도메인으로 공유기까지 닿을 수 있음
- 공유기에서 모든 포트를 윈도우 서버에 포워딩하게 설정. 윈도우 서버까지 닿을 수 있음
- 윈도우에 도커를 설치하고, mysql 컨테이너 안에 DB 들어있음
- compose 파일에서 expose가 아닌 port : "3306:3306" 설정. 호스트에 바로 연결됨.
- mealddang.iptime.org:3306 으로 디비에 바로 접속 가능
- 그리고 root@% 계정 비밀번호를 쉬운걸로 설정
- 도메인과 계정비밀번호를 동시에 써놓고 공개 레포에 올린 적이 있었을까?
- 아니면, 비밀번호가 너무 쉬워서 무작위 시도에 걸린걸까?
- 모든 iptime 도메인에 대해 무작위 시도 할 수는 있겠지만, 모든 도메인의 모든 포트를 시도하지는 않을 텐데. 그 포트가 열려 있는지 확인하고, 있으면 대입해서 접속 시도를 하는걸까?
## DB 뿐만 아니라 다른 시도도 있었을 것
- 모든 포트를 도메인에 노출 시켜 놨기 때문에,
- 다른 포트에서도 무작위 로그인 시도가 있지 않았을까
- 윈도우에도 방화벽이 있고 인바운드 로그가 있다.
- 하지만, 저장하지 않는 것이 디폴트인듯.
- 이제와서 로그 남도록 설정
- 대신 이벤트 로그가 있다.
- ssh와 RDP 양쪽 다 무작위 아이디로 접속 시도할 때 로그인 실패가 로그로 찍힘
- SSH는 비밀번호로 접속할 수 없게 설정해서 괜찮았을듯
- RDP는 접속정보가 평범했으면 뚫렸을지도 모르겠다. 워낙 오래 열심히 시도한듯
## 대처
- 인바운드 포트는 무조건 화이트리스트로 관리
- RDP와 SSH는 가능한 한 비밀번호로 로그인 못하도록
- 도커 컴포즈도 80번 포트 외에는 노출시킬 필요 없다. 호스트와 네트워크 분리. 관리와 개발을 위한 접속은 다른 방법 필요